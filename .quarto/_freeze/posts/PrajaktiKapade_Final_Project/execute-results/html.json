{
  "hash": "dec12ea31670fc202c88e26b0d58d2bd",
  "result": {
    "markdown": "---\ntitle: \"SF Library Usage Analysis\"\nauthor: \"Prajakti Kapade\"\ndescription: \"Final Project\"\ndate: \"12/17/2022\"\nformat:\n  html:\n    toc: true\n    code-copy: true\n    code-tools: true\n---\n\n\n## INTRODUCTION\n\nPrior to computerization, library tasks were performed manually and independently from one another. Selectors ordered materials with ordering slips, cataloguers manually catalogued sources and indexed them with the card catalog system (in which all bibliographic data was kept on a single index card), fines were collected by local bailiffs, and users signed books out manually, indicating their name on clue cards which were then kept at the circulation desk. \n\nEarly mechanization came in 1936, when the University of Texas began using a punch card system to manage library circulation. While the punch card system allowed for more efficient tracking of loans, library services were far from being integrated, and no other library task was affected by this change. This led to customer dissatisfaction and they wanted to move towards a very systematic way of keeping track, then came in Integrated Library systems, one example of which is my dataset for the final project.\n\nThis system is perfect for all educational institutions that wish to maintain minimum operational costs. The system helps with better management, lesser wastage of time and improves engagement and productivity. With this data, we can analyze the trends about different patrons based on their age, based on the registered year, their renewals and checkouts, and see the circulation trend.\n\nResearch Question : How does Age, Patron type, Branch and Residency affect the patrons, their checkouts and their renewals?\n\nInstalling and importing necessary packages\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"hrbrthemes\")\n#install.packages(\"viridis\")\n#install.packages('patchwork')\n#install.packages('zoo')\n#install.packages('directlabels')\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.4.0      ✔ purrr   0.3.5 \n✔ tibble  3.1.8      ✔ dplyr   1.0.10\n✔ tidyr   1.2.1      ✔ stringr 1.5.0 \n✔ readr   2.1.3      ✔ forcats 0.5.2 \n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'ggplot2' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'tibble' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'stringr' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\nlibrary(hrbrthemes)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nNOTE: Either Arial Narrow or Roboto Condensed fonts are required to use these themes.\n      Please use hrbrthemes::import_roboto_condensed() to install Roboto Condensed and\n      if Arial Narrow is not on your system, please see https://bit.ly/arialnarrow\n```\n:::\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(viridis)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'viridis' was built under R version 4.2.2\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: viridisLite\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'viridisLite' was built under R version 4.2.2\n```\n:::\n\n```{.r .cell-code}\nlibrary(RColorBrewer)\nlibrary(patchwork)\nlibrary(ggbeeswarm)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'ggbeeswarm' was built under R version 4.2.2\n```\n:::\n\n```{.r .cell-code}\nlibrary(zoo)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'zoo'\n\nThe following objects are masked from 'package:base':\n\n    as.Date, as.Date.numeric\n```\n:::\n\n```{.r .cell-code}\nlibrary(directlabels)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'directlabels' was built under R version 4.2.2\n```\n:::\n\n```{.r .cell-code}\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n```\n:::\n\n\n## DATA\n\n### Loading the dataset\n\nThe dataset - SF Integrated Learning System is sourced from Kaggle.com and is composed of bibliographic records including inventoried items, patron records, and circulation data. The data is used in the daily operation of the library, including circulation, online public catalog, cataloging, acquisitions, collection development, processing, and serials control. This dataset represents the usage of inventoried items by patrons (~420K records). It contains data starting from 2003 uptill 2016.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_dataset <- read_csv(\"_data/Library_Usage.csv\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError: '_data/Library_Usage.csv' does not exist in current working directory ('C:/Users/srika/OneDrive/Desktop/601_Fall_2022_final_posts/posts').\n```\n:::\n\n```{.r .cell-code}\nlibrary_dataset\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'library_dataset' not found\n```\n:::\n:::\n\n### Summary of the dataset\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(library_dataset)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'library_dataset' not found\n```\n:::\n:::\n\n\nThe dataset contains 423448 records and 15 columns.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(library_dataset)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in glimpse(library_dataset): object 'library_dataset' not found\n```\n:::\n:::\n\nThe above shows the columns of the dataset along with their datatype and the initial recordings of that particular columns. The distinct data types are : dbl - double/real number values, chr - characters and lgl - for boolean values.\n\nThe columns and their description are as follows:\n\n1. `Patron Type Code`- Type of patron record (adult, teen, child, senior, etc.)\n\n2. `Patron Type Definition` - Description of patron (adult, teen, child, senior, etc.).\n\n3. `Total Checkouts`- Total number of items the patron has checked out from the library since the record was created.\n\n4. `Total Renewals` - Total number of times the patron has renewed checked-out items.\n\n5. `Age Range`- Contains age ranges\n\n6. `Home Library Code`- Default value indicates the branch library where the patron was originally registered.\n\n7. `Home Library Definition` - Description of the branch library where the patron was originally registered.\n\n8. `Circulation Active Month` - Year the patron last checked out library materials, or last logged into the library’s subscription databases.\n\n9. `Circulation Active Year` - Month the patron last checked out library materials, or last logged into the library’s subscription databases.\n\n10. `Notice Preference Code`- This field is used to indicate the patron’s preferred method of receiving library notices.\n\n11. `Notice Preference Definition`- Description of the patron’s preferred method of receiving library notices.\n\n12. `Provided Email Address` - Indicates if the patron has provided email address or not.\n\n13. `Year Patron Registered`- Year patron registered with library system. No dates prior to 2003  due to system migration.\n\n14. `Outside of County` - If a patron's home address is not in San Francisco, then flagged as true, otherwise false.\n\n15. `Supervisor District` - Based on patron address: San Francisco Supervisor District. Based on the website it suggested that \"This is an automated field, please note that if \"Outside of County\" is true, then there will be no supervisor district. Also, if the input address was not well-formed, the supervisor district will be blank.\"\n\n\n### Renaming the columns\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_dataset <- library_dataset %>% \n  rename( 'out_of_county' = 'Outside of County', \"patron_type\" = 'Patron Type Definition', \"total_checkouts\" = 'Total Checkouts', \"total_renewals\"= 'Total Renewals', 'age' = 'Age Range', 'branch' = 'Home Library Definition','active_year' = 'Circulation Active Year', 'active_month' = 'Circulation Active Month', 'notice_preference' = 'Notice Preference Definition', 'provided_email' = 'Provided Email Address', 'year_registered' = 'Year Patron Registered', \"outside_of_county\" = 'Outside of County')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in rename(., out_of_county = \"Outside of County\", patron_type = \"Patron Type Definition\", : object 'library_dataset' not found\n```\n:::\n:::\n\n\n### Cleaning the dataset \nSelected the columns with unique characteristic for our visualizations and analysis. Some columns contain the code for the definition example : Home Library Code is the subsequent code for the Home Library Definition.\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data <- library_dataset%>%\n                select(patron_type,total_checkouts,total_renewals,age,branch,active_month,active_year,notice_preference,provided_email,year_registered,outside_of_county)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in select(., patron_type, total_checkouts, total_renewals, age, : object 'library_dataset' not found\n```\n:::\n\n```{.r .cell-code}\nlibrary_data\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'library_data' not found\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data$y_m <- paste(library_data$active_year,library_data$active_month)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in paste(library_data$active_year, library_data$active_month): object 'library_data' not found\n```\n:::\n:::\n\n\n### Loading the branch information\n\nThe dataset mentions the names of different branches of SF Public Library along with their code, but it does not give us any more information about these branches. I extracted some data about the branches from the public library website : https://sfpl.org/locations/#!/filters?sort_by=weight&sort_order=ASC&page=2 and created my own dataset \"branch_info\" (with 30 branches and their information). I have merged it with the original dataset for better information about each branch and their corresponding patrons.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(library_data$branch)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in unique(library_data$branch): object 'library_data' not found\n```\n:::\n:::\n\nThe above shows the different branches of San Franciso Public Library.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbranch_data <- read_csv('_data/branch_info.csv')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError: '_data/branch_info.csv' does not exist in current working directory ('C:/Users/srika/OneDrive/Desktop/601_Fall_2022_final_posts/posts').\n```\n:::\n\n```{.r .cell-code}\nbranch_data\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'branch_data' not found\n```\n:::\n:::\n\n\nJoining the branch_data dataset wih the main dataset based on branch name.\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data <- left_join(library_data, branch_data, by=c(\"branch\"))\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in left_join(library_data, branch_data, by = c(\"branch\")): object 'library_data' not found\n```\n:::\n\n```{.r .cell-code}\nlibrary_data\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'library_data' not found\n```\n:::\n:::\n\n\n### Data Exploration\n\nAs mentioned in my research question, we will look at the number of records based on the categories/columns.\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data%>%\n  filter(age!='NA')%>%\n  ggplot(aes(x = age)) +\n  theme(axis.text.x = element_text(angle = 90))+\n  geom_bar(stat = \"count\",fill='lightblue') +\n  labs(title = \"Number of records by Age Range\",\n       x = \"Age Range\",\n       y = \"Number for Records\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., age != \"NA\"): object 'library_data' not found\n```\n:::\n:::\n\nThe above plot shows the distribution of records based on age range. We can observe that maximum records in the library system lies for the range of 25 to 34 years followed by 35 to 44 years.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = library_data, aes(x = patron_type)) +\n      theme(axis.text.x = element_text(angle = 90))+\n  geom_bar(stat = \"count\",fill='lightpink') +\n  labs(title = \"Number of records by Patron type\",\n       x = \"Patron Type\",\n       y = \"Number for Records\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(data = library_data, aes(x = patron_type)): object 'library_data' not found\n```\n:::\n:::\n\nThe most prominent types of patrons registered in SF Library system are : Adults, Juvenile, Senior, Welcome (guest) and Young Adults.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = library_data, aes(x = branch)) +\n    theme(axis.text.x = element_text(angle = 90))+\n  geom_bar(stat = \"count\",fill='lightyellow') +\n  labs(title = \"Number of records by branches\",\n       x = \"Branches\",\n       y = \"Number for Records\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(data = library_data, aes(x = branch)): object 'library_data' not found\n```\n:::\n:::\n\nThe maximum patrons where registered at the MAIN Library, which makes sense, as the main branch generally has most books and is most accessible to the people.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = library_data, aes(x = outside_of_county)) +\n    theme(axis.text.x = element_text(angle = 90))+\n  geom_bar(stat = \"count\",fill='orange') +\n  labs(title = \"Number of records by Residency\",\n       x = \"Outside of County\",\n       y = \"Number for Records\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(data = library_data, aes(x = outside_of_county)): object 'library_data' not found\n```\n:::\n:::\n\nMost patrons are residing in the San Franciso County itself, while very less patrons are present outside.\n\n### Data Statistics\nThe two main continuous columns of this dataset are : Total Renewals and Total Checkouts made by the patrons. The statistics for which are present below:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(library_data$total_checkouts)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in summary(library_data$total_checkouts): object 'library_data' not found\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(library_data$total_renewals)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in summary(library_data$total_renewals): object 'library_data' not found\n```\n:::\n:::\n\n\n## VISUALIZATIONS \n\n### Patron Registeration by Age Range\nFirstly, we will analyze the trend of \"year when patrons registered\" with the \"Age Range\". This will give us an idea of when patrons registered according to the age groups.\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data%>%\n  filter(age!='NA')%>%\n  ggplot( aes(x=year_registered, group=age, fill=age)) +\n    geom_density(adjust=1.5, alpha=.4) +\n    labs(title = \"Year of Registration by Age Range\",\n       x = \"Year of Registry\",\n       y = \"Number of patrons registered\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., age != \"NA\"): object 'library_data' not found\n```\n:::\n:::\n\nAs expected patrons with ages 60 and higher have been registered since 2003. We can see that the young children from the age of 0-9 years have started registering since 2012, which shows they are curious readers or their parents would've enrolled them to read books and gain information.  \n\n### Total Checkouts and Renewals by Age Range\nNow, we will look into the two important columns total checkouts and total renewals for each category of patrons and different age groups to get an idea of the circulation of the books.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data%>%\nfilter(age!='NA')%>%\nggplot(aes(x = age,y=total_checkouts)) +\n  geom_bar(stat = \"sum\",fill='lightpink') +\n  labs(title = \"Total Checkouts by Age Range\",\n       x = \"Age Range\",\n       y = \"Total number of checkouts\") +coord_flip()+theme(legend.position=\"none\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., age != \"NA\"): object 'library_data' not found\n```\n:::\n:::\n\nThe majority of checkouts in the SF libraries were made by ages: 65 to 74 years followed by 45-54 years and the young readers 10-19 years.This shows us that the every generation is interested in reading books.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(echo = TRUE)\nggplot(data = library_data, aes(x = age,y=total_renewals)) +\n  geom_bar(stat = \"sum\",fill='lightblue') +\n  labs(title = \"Total Renewals by Age Range\",\n       x = \"Age Range\",\n       y = \"Total number of Renewals\") +coord_flip()+theme(legend.position=\"none\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(data = library_data, aes(x = age, y = total_renewals)): object 'library_data' not found\n```\n:::\n:::\n\nThe majority of renewals on the other hand were made by 45-54 years followed by 65-74 years. We can observe using the above two trends that 45-54 and 65-74 years age gaps show maximum engagement and have issued and renewed majority of books as compared to others.\n\n\nNow, we will move towards next category of interest - Patron Type. Looking into the registration year, total checkouts and total renewals made my patrons according to Patron Type.\n\n### Patron registration by Patron Types\n\n::: {.cell}\n\n```{.r .cell-code}\n# Bottom Left\nggplot(library_data, aes(x=patron_type, y=year_registered, fill=patron_type)) + \n    geom_boxplot(alpha=0.3)+ coord_flip()  +  theme(axis.text.x = element_text(angle = 90),legend.position=\"none\") +\n   labs(title='Year of Patron Registration by Patron Type',x='Year Registered',y='Patron type')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(library_data, aes(x = patron_type, y = year_registered, : object 'library_data' not found\n```\n:::\n:::\n\nAs seen from the plot, STAFF, SPECIAL, SENIOR, BOOKS BY MAIL started registration early in 2003, DIGITAL ACCESS CARD type of patrons registered in around 2014.\n\n### Total Checkouts and Renewals by Patron Types\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data %>% \n  ggplot(aes(x=patron_type, y=total_checkouts)) + geom_boxplot(alpha = 0) +\n    geom_jitter(alpha = 0.3, color = \"tomato\")+\n    theme(axis.text.x = element_text(angle = 90))+\n   labs(title = \"Total Checkouts by Patron type\",\n       x = \"Patron type\",\n       y = \"Total number of Checkouts\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(., aes(x = patron_type, y = total_checkouts)): object 'library_data' not found\n```\n:::\n:::\n\nThe majority of checkouts were made by ADULTS and SENIORS as compared to other types of patrons, which validates our theory above.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data %>% \n  ggplot(aes(x=patron_type, y=total_renewals)) + geom_boxplot(alpha = 0) +\n    geom_jitter(alpha = 0.3, color = \"tomato\")+\n  theme(axis.text.x = element_text(angle = 90))+\n   labs(title = \"Total Renewals by Patron type\",\n       x = \"Patron type\",\n       y = \"Total number of Renewals\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(., aes(x = patron_type, y = total_renewals)): object 'library_data' not found\n```\n:::\n:::\n\nThe renewals here show that even though ADULTS and SENIORS had maximum renewals, there were significant renewals by YOUNG ADULTS, JUVENILE and STAFF members as well.\n\nThere is also an important column \"outside_of_county\" which shows the patrons outside of San Franciso. Let us analyze some trends related to the column.\n\n### Patron Registration by Residency\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data%>%\n  filter(age!='NA')%>%\n  ggplot( aes(x=year_registered, group=outside_of_county, fill=outside_of_county)) +\n    geom_density(adjust=1.5, alpha=.4) +\n    labs(title = \"Year of Registration by Residency\",\n       x = \"Year of Registry\",\n       y = \"Number of patrons registered\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., age != \"NA\"): object 'library_data' not found\n```\n:::\n:::\n\nWe can observe, that residents had higher registrations starting 2003, which took a dip in between, and in the recent years from 2012 to 2016, non-residents had higher registrations. It is interesting to see that the awareness has increased amongst people outside SF county as well.\n\n### Total Checkouts and Total Renewals by Residency\nLooking into total checkouts and total renewals based on residency of patrons.\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data %>%ggplot(aes(total_checkouts , outside_of_county)) +geom_boxplot(aes(color=outside_of_county))+labs(title=\"Total Checkouts by Patrons Outside and In County\", x='Outside of County',y='Total Checkouts')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(., aes(total_checkouts, outside_of_county)): object 'library_data' not found\n```\n:::\n:::\n\nThe plot suggests, most of the patrons are present in SF itself. Also, total checkouts for a few patrons in SF cross over 20k as well.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data %>%ggplot(aes(total_renewals , outside_of_county)) +geom_boxplot(aes(color=outside_of_county))+labs(title=\"Total Renewals by Patrons Outside and In County\", x='Outside of County',y='Total Renewals')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(., aes(total_renewals, outside_of_county)): object 'library_data' not found\n```\n:::\n:::\n\nThe plot suggests, most of the patrons are present in SF itself. Also, total renewals for a few patrons in SF are more than 10k.\n\nNow, moving to branches information, and checking the patron registration, total checkouts and total renewals for the same.\n\n### Patrons Registeration by Branches\nThe plots show how many patrons registered in each year for each branch location.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Bottom Left\nggplot(library_data, aes(x=branch, y=year_registered, fill=branch)) + \n    geom_boxplot(alpha=0.3)+ coord_flip()  +  theme(axis.text.x = element_text(angle = 90),legend.position=\"none\") +\n   labs(title='Year of Patron Registration by Branches',x='Year Registered',y='Branch')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(library_data, aes(x = branch, y = year_registered, fill = branch)): object 'library_data' not found\n```\n:::\n:::\n\nThere is an interesting observation in Children's Bookmobile Branch, while most registries of patrons were towards 2012, there was one registry in 2003 (which can be seen as an outlier). We can also observe, West Portal branch and all the Branch bookmobiles had registrations starting in 2003 itself.\n\n### Total Checkouts and Total Renewals by Branches\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(echo = TRUE)\nggplot(data = library_data, aes(x = branch,y=total_checkouts)) +\n  geom_bar(stat = \"sum\",fill='lightblue') +\n  labs(title = \"Total Checkouts by Branch\",\n       x = \"Age Range\",\n       y = \"Total number of Checkouts\") +coord_flip()+theme(legend.position=\"none\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(data = library_data, aes(x = branch, y = total_checkouts)): object 'library_data' not found\n```\n:::\n:::\n\nWe can observe most checkouts were made by patrons in Main Library, which makes sense as Main branch generally has maximum accessibility.\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::opts_chunk$set(echo = TRUE)\nggplot(data = library_data, aes(x = branch,y=total_renewals)) +\n  geom_bar(stat = \"sum\",fill='lightpink') +\n  labs(title = \"Total Renewals by Branch\",\n       x = \"Age Range\",\n       y = \"Total number of Renewals\") +coord_flip()+theme(legend.position=\"none\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(data = library_data, aes(x = branch, y = total_renewals)): object 'library_data' not found\n```\n:::\n:::\n\nSimilarly, Main Library has maximum renewals as compared to other branches, which makes sense as Main branch generally has maximum accessibility.\n\n### Checkouts and Renewals - A trend\nAs, seen the \"Total Checkouts\" and \"Total Renewals\" follow a similar trend for all categories, let us analyze them in with the year of registry.\n\n::: {.cell}\n\n```{.r .cell-code}\nfiltered <- library_data %>%\n  group_by(year_registered) %>%                    # group by\n  summarise(check = mean(total_checkouts), rene = mean(total_renewals)) \n```\n\n::: {.cell-output .cell-output-error}\n```\nError in group_by(., year_registered): object 'library_data' not found\n```\n:::\n\n```{.r .cell-code}\nggplot() +\n  geom_line(data = filtered, aes(x=year_registered, y=check),arrow = arrow(), color=\"#69b3a2\",size=2)+\n  geom_point(size=2, color=\"#69b3a2\")+\n   labs(title = \"Average Checkouts by Year of Registry\",\n     x = \"Year Registered\",\n     y = \"Average number of Checkouts\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in fortify(data): object 'filtered' not found\n```\n:::\n\n```{.r .cell-code}\nmyarrow=arrow(angle = 15, ends = \"both\", type = \"closed\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfiltered <- library_data %>%\n  group_by(year_registered) %>%                    # group by\n  summarise(check = mean(total_checkouts), rene = mean(total_renewals)) \n```\n\n::: {.cell-output .cell-output-error}\n```\nError in group_by(., year_registered): object 'library_data' not found\n```\n:::\n\n```{.r .cell-code}\nggplot() +\n  geom_line(data = filtered, aes(x=year_registered, y=rene),arrow = arrow(), color=\"lightblue\",size=2)+\n  geom_point(size=2, color=\"lightblue\")+\n   labs(title = \"Average Renewals by Year of Registry\",\n     x = \"Year Registered\",\n     y = \"Average number of Renewals\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in fortify(data): object 'filtered' not found\n```\n:::\n\n```{.r .cell-code}\nmyarrow=arrow(angle = 15, ends = \"both\", type = \"closed\")\n```\n:::\n\nThe values of checkouts and renewals have been declining over the years, having been at its highest in 2003 and being the lowest in value by 2016. There was a slight increase in 2007 but was not much significant. This totally makes sense, as the people who registered way before had more time, thus, more checkouts and subscriptions.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data %>%\n  filter(active_year!='None')%>%# data                 \n  group_by(active_year) %>%                   \n  summarise(y = mean(total_checkouts)) %>% \nggplot( aes(x=active_year, y=y, group=1)) +\n  geom_line(arrow = arrow(),color=\"#D55E00\", size=2)+\n  geom_point(color=\"#D55E00\", size=2)+\n   labs(title = \"Average Checkouts by Active Year\",\n     x = \"Active Year (Last year of activity)\",\n     y = \"Average number of Checkouts\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., active_year != \"None\"): object 'library_data' not found\n```\n:::\n\n```{.r .cell-code}\nmyarrow=arrow(angle = 15, ends = \"both\", type = \"closed\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data %>%\n  filter(active_year!='None')%>%# data                 \n  group_by(active_year) %>%                    # group by\n  summarise(y = mean(total_renewals)) %>% \nggplot( aes(x=active_year, y=y, group=1)) +\n  geom_line(arrow = arrow(),color='#E69F00',size=2)+\n  geom_point(color='#E69F00',size=2)+\n   labs(title = \"Average Renewals by Active Year\",\n     x = \"Active Year (Last year of activity)\",\n     y = \"Average number of Renewals\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., active_year != \"None\"): object 'library_data' not found\n```\n:::\n\n```{.r .cell-code}\nmyarrow=arrow(angle = 15, ends = \"both\", type = \"closed\")\n```\n:::\n\nThe Checkouts and renewals value is increasing significantly from year to year and the highest value was in 2016. This basically shows us the trend about how people are issuing more and more books moving forward.\n\nAs, seen Total renewals and Total Checkouts clearly follow similar trends, let us confirm their correlation using a plot.\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(library_data$total_checkouts, library_data$total_renewals, pch = 19, col = \"lightblue\",xlab=\"Total Checkouts\", ylab=\"Total Renewals\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in plot(library_data$total_checkouts, library_data$total_renewals, : object 'library_data' not found\n```\n:::\n\n```{.r .cell-code}\n# Regression line\nabline(lm( library_data$total_renewals ~ library_data$total_checkouts), col = \"red\", lwd = 3)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(predvars, data, env): object 'library_data' not found\n```\n:::\n\n```{.r .cell-code}\n# Pearson correlation\ntext(paste(\"Correlation:\", round(cor(library_data$total_checkouts,  library_data$total_renewals), 2)),x=30000,y=1000)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in is.data.frame(y): object 'library_data' not found\n```\n:::\n:::\n\nThe plot suggests a strong correlation between total checkouts and total renewals with a pearson coefficient of 0.59 ~ 0.6.\n\n### Diving Deeper into Monthly data\nNow, we will take a deeper look into the total checkouts/renewals trend by analyzing the monthly data for all patrons.\n\n### Total Checkouts by months for year 2016\nAs, this dataset provides information about monthly checkouts and renewals, we will look at monthly charts for latest year in the records i.e. 2016, to understand what trends have been lately.\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data %>%\n    filter(active_year=='2016')%>%\n    ggplot(aes(x = y_m, fill = total_checkouts)) +\n    geom_histogram( fill=\"#404080\", alpha=0.6, stat = \"count\") + theme(axis.text.x = element_text(angle = 90, hjust = 1), legend.position = \"none\")+ labs(title=\"Total Checkouts by Month for year 2016\", y=\"Total Checkouts\",x=\"month\")+coord_flip()\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., active_year == \"2016\"): object 'library_data' not found\n```\n:::\n:::\n\nThe histogram suggests the majority of checkouts occurred in month of July followed by June. To understand the trends better we will dive deep into July 2016 patron records.\n\n### Trends of Age Range and Patron Type for July 2016\nLooking closely into July data, to understand the distribution of Total Checkouts by Age and Patron type:\n\n::: {.cell}\n\n```{.r .cell-code}\nfilter_data <- library_data %>%\n  filter(y_m =='2016 July')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., y_m == \"2016 July\"): object 'library_data' not found\n```\n:::\n\n```{.r .cell-code}\nfilter_data <- aggregate(filter_data$total_checkouts, by=list(Age_Range=filter_data$age), FUN=mean)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in aggregate(filter_data$total_checkouts, by = list(Age_Range = filter_data$age), : object 'filter_data' not found\n```\n:::\n\n```{.r .cell-code}\nfilter_data\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'filter_data' not found\n```\n:::\n\n```{.r .cell-code}\nggplot(data = filter_data, aes(x = \"\", y = x, fill = Age_Range)) + \n  geom_bar(stat = \"identity\") + \n  coord_polar(\"y\")+\n  labs(title=\"Total Checkouts by Age Range\")+\n  scale_fill_brewer(palette = \"Paired\")+\n  theme(axis.text = element_blank(),\n        axis.ticks = element_blank(),\n        panel.grid  = element_blank())+\n  labs(x=\"\", y=\"\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(data = filter_data, aes(x = \"\", y = x, fill = Age_Range)): object 'filter_data' not found\n```\n:::\n:::\n\nThe pie chart shows the major contributions of checkouts in July 2016 were made by ages 45 years and above.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nco <- c(\"#FFDB6D\", \"#C4961A\", \"#F4EDCA\", \n                \"#D16103\", \"#C3D7A4\", \"#52854C\", \"#4E84C4\", \"#293352\",\"#000000\", \"#E69F00\", \"#56B4E9\", \"#009E73\",\n          \"#F0E442\", \"#0072B2\", \"#D55E00\", \"#CC79A7\",\"#999999\")\nfilter_data <- library_data %>%\n  filter(y_m =='2016 July')\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., y_m == \"2016 July\"): object 'library_data' not found\n```\n:::\n\n```{.r .cell-code}\nfilter_data <- aggregate(filter_data$total_checkouts, by=list(Patron_Types=filter_data$patron_type), FUN=mean)\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in aggregate(filter_data$total_checkouts, by = list(Patron_Types = filter_data$patron_type), : object 'filter_data' not found\n```\n:::\n\n```{.r .cell-code}\nfilter_data\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in eval(expr, envir, enclos): object 'filter_data' not found\n```\n:::\n\n```{.r .cell-code}\nggplot(data = filter_data, aes(x = \"\", y = x, fill = Patron_Types)) + \n  geom_bar(stat = \"identity\") + \n  coord_polar(\"y\")+\n  labs(title=\"Total Checkouts by Patrons type\")+\n  scale_fill_manual(values=co)+\n  theme(axis.text = element_blank(),\n        axis.ticks = element_blank(),\n        panel.grid  = element_blank())+\n  labs(x=\"\", y=\"\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(data = filter_data, aes(x = \"\", y = x, fill = Patron_Types)): object 'filter_data' not found\n```\n:::\n:::\n\nThe pie chart suggests major contributions in July 2016 for checkout were made by Retired Staff and Staff members.\n\nLastly, let us analyze total checkouts/renewals (As they follow similar trend) and patron registration using two categories at the same time for better view.\n\n### Total Checkouts by Patron Types and Age Ranges\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary_data %>%\n  filter(age!='NA')%>%\nggplot( aes(x=age, y=patron_type, size = total_checkouts)) +\n    geom_point(alpha=0.7) +\n  theme(axis.text.x = element_text(angle = 90))+\n  labs(title=\"Total checkouts by Patron Types and Age Ranges\",x='Age Range',y='Patron Type') \n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., age != \"NA\"): object 'library_data' not found\n```\n:::\n:::\n\nWe can observe major activity were made by ADULTS of age 35-44 years and 45-54 years,SENIORS of 65-74 years. There are also a few checkouts by STAFF members with ages 0-9 years, which looks suspicious.\n\n\n### Different Patron types by year of registery and their residence.\nThis shows density of patrons based on the year of registration of different types of patrons residing in and out of San Franciso.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Using Small multiple\n\nggplot(data=library_data, aes(x=year_registered, group=outside_of_county, fill=outside_of_county)) +\n    geom_density(adjust=1.5,alpha = 0.4) +\n    facet_wrap(~patron_type) +\n    theme(\n      legend.position = \"bottom\",\n      panel.spacing = unit(0.5, \"lines\"),\n      axis.ticks.x=element_blank(),\n    )+\n  labs(title=\"Patron density based on year of registration, patron type and residency\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in ggplot(data = library_data, aes(x = year_registered, group = outside_of_county, : object 'library_data' not found\n```\n:::\n:::\n\nWe can observe, patrons of Digital Access Card type have most registrations for both residents and non-residents. We can also see that Retired Staff had most registrations in 2003, with residents having double registrations than non-residents.\n\n### Different Age Range by year of registery and their residence.\nThis shows density of patrons based on the year of registration for different age groups residing in and out of San Franciso.\n\n::: {.cell}\n\n```{.r .cell-code}\n# Using Small multiple\n\nlibrary_data%>%\n  filter(age!='NA')%>%\n  ggplot( aes(x=year_registered, group=outside_of_county, fill=outside_of_county)) +\n    geom_density(adjust=1.5, alpha=.4) +\n    facet_wrap(~age) +\n    theme(\n    legend.position = \"bottom\",\n      panel.spacing = unit(0.9, \"lines\"),\n      axis.ticks.x=element_blank()\n    )+\n  labs(title=\"Patron density based on year of registration, age range and residency\")\n```\n\n::: {.cell-output .cell-output-error}\n```\nError in filter(., age != \"NA\"): object 'library_data' not found\n```\n:::\n:::\n\nWe can observe, most patrons of ages 65-74 years registered in 2003, which makes sense as they are old and would have registered earlier, also residents have almost 1.5 times more registrations than non-residents in this age range in year 2003. Also, for age range 10-19 years and 20-24 years, there are mostly non-residents who have registered after 2012, while residents are very less.\n\n## REFLECTION\nThis project and working with R has been a learning experience for me as I am a Computer Science student. While starting this project, I thought maybe the San Franciso Library Usage dataset would be very concise, but as I kept diving into the dataset, I realized it has so much information about patrons, the library branches, the age groups and their contributions to checkouts and renewals of books. The Integrated library management dataset gave me some interesting findings.\n\nMy strategy was to understand how each category(column) is affecting the checkouts and renewals, and then if any interesting observation was seen, I would  move forward with digging in more in that direction. For eg: I looked into 2016's data per month and found that July had the most checkouts. I dived in to the July 2016's data to understand who made those checkouts? Which age range and patron type contributed the most to it? This approach made the visualization making process very intriguing for me.\n\nThe dataset had a lot of records, but to incorporate more information on branches I searched through the SF public library website and manually loaded the data to a csv, which I then incorporated in the main dataset. Challenging part was to understand what different fields mean, specially what different year values signify? Also, understanding from whose point of view is this data made and whats the timeline?\n\nI tried to learn, have fun with it, and incorporate all types of plots, specially histograms, density plots and facet_wrap which made it easier to see observations. If we had more information about the data from other parts of California or USA, I could have found trends for a much higher population using these visualizations. Also, we need more information about the branches, as only geographical information was available on the website. Apart from that, some information about the different categories of books, which age groups like which categories more, that would be an interesting research to do.\n\n## CONCLUSION\n\nStarting from the basics, there were 10 Age ranges varying over 17 Patron Types, 34 branches and over 4 lakh records. The visualizations gave us insights about which Age Range is making the most checkouts and renewals - and it was inspiring to figure out that 10-19, 45-54 and 65-74 age ranges had the maximum checkouts, this implies all generations are interested in issuing books and reading them, which is a great habit. It was also seen that ADULTS and SENIORS had the highest checkouts and renewals, which means they take some time reading it or re-read it, by renewing the books. Comparatively, there are also high renewals for YOUNG ADULTS, students generally tend to issue some books for studying and end up renewing them. Looking at residency, I observed that residents have higher checkouts and renewals than non-residents, but it was interesting to observe that the non-residents patron registration has increased over the coming years, which suggests that the awareness among the people outside the SF county has increased and they are also issuing books now. Lastly, looking at the branches, it was observed that the most checkouts and renewals were made at the Main Library branch, which made sense as Main branch is generally most accessible to patrons.\n\nIt was very clear, that checkouts and renewals were strong correlated, which does make sense intuitively. I showed it using the pearson coefficient in our code above. The plots also reflected that the checkouts and renewals have increased over time, that means people are getting more and more interested in issuing and reading books. Another trend, I noted was related to \"Year of Registry\" and \"Average Checkouts/Average Renewals\", which should intuitively follow a decreasing trend (as people who registered earlier will definitely have more checkouts due to more time), but there was a slight increase in 2007, so that was definitely an anomaly.\n\nFor having a better look into the data, I looked into the latest year's data per month and found that July had the most checkouts. I dived into the July 2016 data and figured they were majorly made by patrons of age 45 and above, and most of them were Staff members or Retired staff. One reason for this could be the holiday season for students, as they do not contribute much towards the checkouts. \n\nUsing the three dimensional plots, we observed that patrons of Digital Access Card type have most registrations for both residents and non-residents, while Retired Staff had most registrations in 2003, with residents having double registrations than non-residents. Also, most patrons of ages 65-74 years registered in 2003, which makes sense as they are old and would have registered earlier. For age range 10-19 years and 20-24 years, there are mostly non-residents who have registered after 2012, while residents are very less. This seems very interesting, and shows people outside SF are also coming to issue books.\n\nAfter so many observations, we still do not know how Age Ranges and Patron Types are related, and will need some more information about them. Also, how are different branches related to each other? Do they share some books? Some more information can lead to better observations and analysis, but all these visualizations on our dataset, were definitely insightful and enlightened me about the SF Integrated Library System.\n\n## BIBLIOGRAPHY\n\nRStudio Team (2022). RStudio: Integrated Development Environment for R. RStudio, PBC, Boston, MA, http://www.rstudio.com/.\n\nWickham, H., François, R., Henry, L., & Müller, K. (n.d.). Programming with dplyr. dplyr. https://dplyr.tidyverse.org/articles/programming.html\n\nWickham, H. & Grolemund, G. (n.d.). R for data science [eBook edition]. O’Reilly. https://r4ds.had.co.nz/index.html\n\nWickham et al. (2019). Welcome to the tidyverse. Journal of Open Source Software, 4(43), 1686. https://doi.org/10.21105/joss.01686\n\nSource of Dataset : https://www.kaggle.com/datasets/datasf/sf-library-usage-data\n\nhttps://data.sfgov.org/Culture-and-Recreation/Library-Usage/qzz6-2jup\n\nSF Public Library Website : https://sfpl.org/ \n\nBranch Information : https://sfpl.org/locations/#!/filters?sort_by=weight&sort_order=ASC&page=2\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}