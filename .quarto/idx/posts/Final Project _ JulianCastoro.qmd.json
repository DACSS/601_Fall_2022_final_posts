{"title":"Global Military Spending - An Analysis","markdown":{"yaml":{"title":"Global Military Spending - An Analysis","description":"WIP Final Project","author":"Julian Castoro","date":"`r Sys.Date()`","format":{"html":{"toc":true,"code-fold":true,"code-copy":true,"code-tools":true,"df-print":"paged"}},"editor":{"markdown":{"wrap":72}},"tags":["Julian Castoro","Final Project"]},"headingText":"| label: setup","containsRefs":false,"markdown":"\n\n```{r warning=FALSE, message=FALSE}\n#| warning: false\n#| message: false\n\nlibrary(tidyverse)\nlibrary(lubridate)\n\nlibrary(ggplot2)\nlibrary(gganimate)\n\nlibrary(readxl)\nlibrary(dplyr)\nlibrary(purrr)\nlibrary(lubridate)\n\nlibrary(leaflet)\n\n\noptions(digits = 3,decimals=2)\noptions(scipen = 999)\nknitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)\n\n```\n\n\n# Introduction\n\n\n![Global Government spending(current USD), Size correlates with Share of GDP](GovSpend_VS_RawUSD.gif)\n\n## Data choice overview\n\nI initially chose this data set because recent events abroad have\ncertainly escalated a global fear of war and I wanted to see how the\ntides of military spending ebbed and flowed over the course of recent\nhistory. The more I cleaned the data and played around with\nvisualizations, the more questions I had. I am excited to see what sort\nof trends come from analyzing this data set.\n\nI plan to show how different countries and regions value military\nspending and how that value changes over the course of time. Ideally I\nwill be able to explain patterns in what I see with global or locally\nimportant historic events. How did the US spending change after 9/11 or\nmore recently did we see anyone bolstering their defenses before news\nbroke of the Russian invasion of Ukraine? How did spending change\nglobally after the first and then second world war? While I am not a\nstatistical expert and will not be able to refute a causation vs\ncorrelation argument, visualizations of these events and the\ncorresponding spending patterns will still be interesting and hopefully\nprovoking of conversation.\n\n## Data\n\n### Description\n\nBelow is a list of the available sheets in the SIPRI military spending\ndata export. A few of the tabs are the same base information altered to\nreflect a specific currency or ratio. I am choosing to use the \"Current\nUSD\" as my source of raw spending numbers as I believe it to be the\neasiest to understand and relate to. I will also be using \"share of GDP\"\nas well as \"Share of Govt. spending\" to provide context around a nations\nspending compared to their population they intend on defending as well\nas compared to overall spending. The Constant (2020) USD values are all in Millions. \n\nThere will be NA's throughout the dataset which represent the fact that the data was unavailable at that time. This could mean that the country did not exist in that year or they were unwilling to share their military spending information with SIPRI and so the NAs have been left in to reflect that fact. Data exists for at least one country from 1949 to 2021. There are 173 total countries in the database with the full list as well as some additional information in the appendix.\n\n\"Gross domestic product (GDP) is the total monetary or market value of\nall the finished goods and services produced within a country's borders\nin a specific time period.\" - Investopedia\n\n```{r}\nsheets <- excel_sheets(\"_data/SIPRI-Milex-data-1949-2021.xlsx\")\nsheets\n\n```\n\n\n\n### Source\n\nThe Military spending information I am analyzing comes from **SIPRI**,\nthe **S**tockholm **I**nternational **P**eace **R**esearch\n**I**nstitute. SIPRI was established in 1966 for the purpose of\n\"research into conflict, armaments, arms control and disarmament\". The\norganization is funded by the Swedish government however it regularly\nworks internationally with research centers around the globe. SIPRI\ncollected this particular data set from the official reports of each of\nthe included governments in the form of official publications such as\npublic budgets.\n\nHere is a peek at what the raw information looks like.\n\n```{r message=FALSE,R.options= (tibble.max_extra_cols=0)}\n#| warning: false\n#| message: false\nrawrawData_ShareOfGovSpend <- read_excel(\"_data/SIPRI-Milex-data-1949-2021.xlsx\",sheet=sheets[9])\n#knitr::kable(head(rawrawData_ShareOfGovSpend,10),\"simple\")\nhead(rawrawData_ShareOfGovSpend,10)\n\n```\n\n# Input and Cleaning\n\n## Reading in raw information\n\nThe data provided by the Stockholm International Peace Research\nInstitute(SIPRI) was separated into multiple tabs in one excel .xlsx\nfile.\n\nIn order to begin working I imported the tabs I planned to utilize,\nskipping over some of the notes and title rows at the start of each tab.\n\n```{r}\nrawData_CurrentUSD <- read_excel(\"_data/SIPRI-Milex-data-1949-2021.xlsx\",sheet=sheets[6],skip=5)\nrawData_ShareOfGDP <- read_excel(\"_data/SIPRI-Milex-data-1949-2021.xlsx\",sheet=sheets[7],skip=5)\nrawData_ShareOfGovSpend <- read_excel(\"_data/SIPRI-Milex-data-1949-2021.xlsx\",sheet=sheets[9],skip=7)\n```\n\n```{r echo=FALSE}\n# output\n#head(rawData_CurrentUSD)\n#head(rawData_ShareOfGDP)\n#head(rawData_ShareOfGovSpend)\n```\n\nNext I delete the first row of NA as well as the Notes column for each\ntibble.\n\n```{r}\nrawData_CurrentUSD <- rawData_CurrentUSD[-1,]  %>%\n  select(-Notes)\nrawData_ShareOfGDP <- rawData_ShareOfGDP[-1,] %>%\n  select(-Notes)\nrawData_ShareOfGovSpend <- rawData_ShareOfGovSpend[-1,] %>%\n  select(-2:-3)\n```\n\n```{r echo=FALSE}\n#head(rawData_CurrentUSD)\n#head(rawData_ShareOfGDP)\n#head(rawData_ShareOfGovSpend)  \n```\n\n## Tidying Data\n\nBefore pivoting my data I wanted to add a column for region. I chose to\ndo this with an algorithm as an exercise in iteration however it would\nhave been more practical to just hard code this column.\n\nThe list of countries where there are NA's for every year:\n\n```{r}\nRegions <- rawData_CurrentUSD %>%\n  filter(is.na(`1949`))%>%\n  select(Country)\n\nRegions\n```\n\nYou will notice that some of these are continents and sub-continents, I\nwanted to break these into a `Region` field. The pattern I saw and chose\nto exploit was the fact that the overarching category would always be\nfollowed with a more specific category such as the **Africa** followed\nby **North Africa** values (see earlier print outs to see raw\ninformation).\n\nI then added an empty vector into the tibble and populated it according\nto the Country column using the pattern described above.\n\nOnce I had left flags in the region column dictating where each region\nwas starting I could use `fill(Region)` in order to populate the rest of\nthe column.\n\n```{r}\nemptyRegionCol <- as.numeric(vector(mode = \"character\",length = length(rawData_CurrentUSD$`1949`)))## doing as numeric here as a hacky way to fill this with NA's, any better way?\n\n#adding col to tibble to be populated later\nmutated_CurrentUSD <- rawData_CurrentUSD %>%\n  mutate(Region =emptyRegionCol,.before=2)\n\n# replacing the empty char in region with actual region if 2 NAs appear in a row\n  #iterates along the indices of the Country vector\nfor(i in seq_along(mutated_CurrentUSD$Country) ){\n   #if 2 nas in a row then do something\n  if(is.na(mutated_CurrentUSD$`1949`[i]) && is.na(mutated_CurrentUSD$`1949`[i+1]) ){\n    mutated_CurrentUSD$Region[i+1] <- mutated_CurrentUSD$Country[i+1] #this works because when referencing an index outside of the vector R will return NA - Great to know.\n  }\n  #if the row is a region\n  if(is.na(mutated_CurrentUSD$`1949`[i]) ){\n     mutated_CurrentUSD$Region[i+1] <- mutated_CurrentUSD$Country[i]\n  }\n}\n\nmutated_CurrentUSD <- mutated_CurrentUSD %>%\n  fill(Region)\n\nhead(mutated_CurrentUSD)\n```\n\nNow that I had my proof of concept for cleaning one of the sheets, in a\nformat I wanted, it was time to clean the other sheets as well. I could\nhave taken the above code and modified it to work for each of the\nother tabs individually however I took the opportunity to practice with\nfunctions and created the below function to clean any of the tabs once\nthey were loaded in and lightly pre-processed.\n\n## Clean and format function\n\n```{r}\n## creating a function to clean the other sheets\n##Input: a partially cleaned tibble, must have been read in and had excess rows trimmed\n##output: tibble with regions correctly labeled and umbrella region categories i.e Africa above south Africa removed\n##Note: All sub categories contained the main category name in them, will use regex to create groupings in the future.\nCleanData <- function(inSheet){\n  emptyRegionCol <- as.numeric(vector(mode = \"character\",length = nrow(select(inSheet,2))))\n\n  #adding col to tibble to be populated later\n  output <- inSheet %>%\n    mutate(Region = emptyRegionCol,.before=2)\n\n\n  # replacing the empty char in region with actual region if 2 NAs appear in a row\n    #iterates along the indices of the Country vector\n  for(i in seq_along(output$Country)){\n  \n    if(is.na(output[[i,3]]) && is.na(output[[(i+1),3]]))\n      output$Region[i+1] <- output$Country[i+1]\n    \n    if(is.na(output[[i,3]]))\n       output$Region[i+1] <- output$Country[i]\n  }\n  \n  output <- output %>%\n    fill(Region)\n  \n  \n  # removing header rows\n  output <- output %>%\n    filter(!is.na(output[[3]]))\n}\n\n```\n\nBelow I call the function on each of the tibbles loaded in earlier. For\nthe sake of space I will only show one tab being cleaned.\n\nBefore:\n\n```{r echo=FALSE}\n#head(rawData_CurrentUSD)\n#head(rawData_ShareOfGDP)\nhead(rawData_ShareOfGovSpend)\n```\n\n```{r}\nCleaned_currentUSD <- CleanData(rawData_CurrentUSD)\nCleaned_ShareOfGovSpend <- CleanData(rawData_ShareOfGovSpend)\nCleaned_ShareOfGDP <- CleanData(rawData_ShareOfGDP)\n```\n\nAfter:\n```{r echo=FALSE}\n#head(Cleaned_currentUSD)\n#head(Cleaned_ShareOfGovSpend)\nhead(Cleaned_ShareOfGDP)\n\n```\n\n## Pivoting and Restructuring\n\n### Pivot and Notation Changes\n\nNext I pivot the years, it should be noted that both the pivoting and\nConverting of notation could be handled by the clean function above, i\nkept the steps separate so that I could show the progression of the\ndataframe.\n\nI must also handle the xxx and ... notations. From the information page\nof my data set I can see that the notation is described as follows:\n\n| Raw Notation | Meaning                                                                                 |\n|------------------------------------|------------------------------------|\n| ...          | Data unavailable                                                                        |\n| xxx          | Country did not exist or was not independent during all or part of the year in question |\n\nFor now I think I will just keep both as NA but will save this form of\nthe information for future use.\n\nAfter pivot and notation changes:\n\n```{r}\nCleaned_currentUSD <- Cleaned_currentUSD %>%\n  pivot_longer(cols=3:ncol(Cleaned_currentUSD),names_to = \"Year\",values_drop_na = FALSE)%>%\n    na_if(\"...\") %>%\n      na_if(\"xxx\")\n  \nCleaned_ShareOfGovSpend <- Cleaned_ShareOfGovSpend %>%\n  pivot_longer(cols=3:ncol(Cleaned_ShareOfGovSpend),names_to = \"Year\",values_drop_na = FALSE)%>%\n    na_if(\"...\") %>%\n      na_if(\"xxx\")\n\nCleaned_ShareOfGDP <- Cleaned_ShareOfGDP %>%\n  pivot_longer(cols=3:ncol(Cleaned_ShareOfGDP),names_to = \"Year\",values_drop_na = FALSE)%>%\n    na_if(\"...\") %>%\n      na_if(\"xxx\")\n\n\ndf1<-head(Cleaned_currentUSD)\ndf2<-head(Cleaned_ShareOfGovSpend)\ndf3<-head(Cleaned_ShareOfGDP)\n\n\n#df1\n#df2\n# share of GDP\n#df3\n\n\n```\n\n### Converting Column Types\n\nFinally I will convert the column types to their correct representation.\n\n```{r}\n#Year to Number\nCleaned_currentUSD$Year<-as.integer(Cleaned_currentUSD$Year)\nCleaned_ShareOfGovSpend$Year<-as.integer(Cleaned_ShareOfGovSpend$Year)\nCleaned_ShareOfGDP$Year<-as.integer(Cleaned_ShareOfGDP$Year)\n\n# value to double\nCleaned_currentUSD$value <- as.numeric(Cleaned_currentUSD$value)\nCleaned_ShareOfGovSpend$value<- as.numeric(Cleaned_ShareOfGovSpend$value)\nCleaned_ShareOfGDP$value<- as.numeric(Cleaned_ShareOfGDP$value)\n```\n\n\n\n```{r echo=FALSE}\nCleaned_currentUSD <- Cleaned_currentUSD %>%\n  rename(MilitarySpend_currentUSD=value)\n\nCleaned_ShareOfGovSpend <- Cleaned_ShareOfGovSpend%>%\n  rename(MilitarySpend_ShareofGovSpend=value)\n\nCleaned_ShareOfGDP <- Cleaned_ShareOfGDP%>%\n  rename(MilitarySpend_ShareofGDP=value)\n\n```\n\n### Joining of the Different Tabs\n\nHere we do a full join to maintain data from all the different tabs. The years when share of Gov spend are unavailable will then show NA as intended.\n\n```{r}\nMilitarySpend<- full_join(Cleaned_currentUSD,Cleaned_ShareOfGovSpend,by=c(\"Country\",\"Year\",\"Region\"))\nMilitarySpend <- full_join(MilitarySpend,Cleaned_ShareOfGDP,by=c(\"Country\",\"Year\",\"Region\"))\n\nhead(MilitarySpend)\n\n```\n\n# Descriptive stats\n\n## Pivoting\n\nMean, Median and Standard Deviation for each of the tabs.\n\nFirst I wanted to get an idea of what my data looks like for each of the\ncountries individually. In order to see this I grouped on country name\nand the types of data we have.\n\nIn order to get that done I need to pivot my data again.\n\n```{r}\ncombinedData <-MilitarySpend %>%\n  pivot_longer(c(MilitarySpend_currentUSD,MilitarySpend_ShareofGovSpend,MilitarySpend_ShareofGDP),names_to = \"viewOfSpend\",values_to = \"Spend\")\nhead(combinedData)\n\ncombinedData<-na.omit(combinedData)\n\n```\n\nTotal number of countries analyzed:\n\n```{r echo=FALSE}\ntotNumCountries<-combinedData%>%\n  distinct(Country)%>%\n  count()\n```\nList of Countries:\n```{r echo=FALSE}\nListOfCountries<-combinedData%>%\n  distinct(Country,Region)%>%\n  arrange(Country)\n```\n\n\nNumber of countries by region:\n```{r echo=FALSE}\nNumCountriesByRegion<-combinedData%>%\n  group_by(Region)%>%\n  summarise(numberCountries = n_distinct(Country))%>%\n  arrange(desc(numberCountries))\n\n```\n\n## Statistics by region\nNow that I have all of my data in a malleable state I will do some initial statistics on each tab of the initial dataset to give asome insight to what patterns or outliers may exist.\n\n\n### MilitarySpend_currentUSD\n\nI will be using the current USD data for my analysis of major world events so I will not dive deeper at this point.\n\n```{r}\nbyRegionStats_USD<-combinedData%>%\n  group_by(Region,viewOfSpend)%>%\n  summarize(mean = mean(Spend, na.rm=TRUE,sigfig=1),\n            std = sd(Spend, na.rm=TRUE),\n            min = min(Spend, na.rm=TRUE),\n            max = max(Spend, na.rm=TRUE))%>%\n  arrange(desc(mean))%>%\n  filter(viewOfSpend==\"MilitarySpend_currentUSD\")\n\nbyRegionStats_USD\n\n```\n\n### MilitarySpend_ShareOfGDP\n\n```{r warning=FALSE, message=FALSE}\nbyRegionStats_GDP<-combinedData%>%\n  group_by(Region,viewOfSpend)%>%\n  summarize(mean = mean(Spend, na.rm=TRUE,sigfig=1),\n            std = sd(Spend, na.rm=TRUE),\n            min = min(Spend, na.rm=TRUE),\n            max = max(Spend, na.rm=TRUE))%>%\n  arrange(desc(mean))%>%\n  filter(viewOfSpend==\"MilitarySpend_ShareofGDP\")\n\nbyRegionStats_GDP\n\n```\n\nAfter sorting by mean share of GDP spend I see that the middle east has the highest by quite a large margin. This is odd because usally the US(North America), has the highest military spending. A max of 1.17 for GDP is also stageringly high when compared to the other regions. This prompts further investigation. A violin plot below gives a visualization of this distribution.\n\n\n```{r}\nbyRegionStats_GDP<-combinedData%>%\n  group_by(Region,viewOfSpend,Year)%>%\n  filter(viewOfSpend==\"MilitarySpend_ShareofGDP\")\n\n\nbyRegionStats_GDP$Region<-as.factor(byRegionStats_GDP$Region)\n\nviolin_gdp<- na.omit(byRegionStats_GDP)%>%\n  ggplot(aes(x=Region,y=Spend))+\n  geom_violin()+\n  theme(axis.text.x=element_text(angle=60,hjust=1))\n\nviolin_gdp\n\n# removing NAs here because I cant plot them, I dont want to replace them with other values because it is still of interest when countries do not display their data.\n\n```\n\nUpon investigation of the underlying data I see that Kuwait in 1991 is the culprit of the high military spending as percent of GDP number.\n\n```{r}\nbyRegionStats_GDP%>%\n  filter(Region==\"Middle East\")%>%\n  arrange(desc(Spend))%>%\n  head()\n```\n\nI initially thought this was a typo since there were two 1s in a row and\nit was such an insanely high spend. A share of GDP of 1.173 means Kuwait\nspent 117.3% of their GDP in that year. Upon further investigation, this\nis actually true and it was driven by the Persian Gulf War(aka Gulf\nWar). The Gulf War was a conflict triggered by Iraqs invasion of Kuwait\nin 1990. This invasion was the first major international crisis since\nthe Cold War and will certainly be a topic I add to the final analysis.\n\nhttps://www.britannica.com/event/Persian-Gulf-War\n\nLoosely I will plot Iraq, US and Kuwait spend from 1985-1995 to explore\nthis time period.\n\n```{r warning=FALSE}\ncombinedData%>%\n  filter(Year >= 1985 & Year<= 1995)%>%\n  filter(Country %in% c(\"United States of America\",\"Iraq\",\"Kuwait\"))%>%\n    ggplot(mapping=aes(y = Spend, x = Year))+  \n    geom_line(aes(color = Country),na.rm = FALSE)+\n    facet_wrap(vars(`viewOfSpend`),scales = \"free_y\")\n```\n\nA new discovery! Iraq chose not to report their spending during the Gulf\nwar. This is most likely due to the fact that SIPRI data collection is funded by the Swedish government who have pretty close ties to the United States. Sweden was one of the first countries to recognize US independence in 1783. Below I highlight reported Iraqi military spending overlaid with markings for the start and end of their reported data. We can see that in the time leading up to the gulf war military spending rose sharpley and even after the war they continued to spend above historical levels.\n\n```{r warning=FALSE}\nstartOfNoData<- 1982\nendofNoData<- 2003\n\niraqMissingDataPLOT<-combinedData%>%\n  filter(Country %in% c(\"Iraq\"))%>%\n    ggplot(mapping=aes( x = Spend,y = Year))+\n    geom_point()+\n    facet_wrap(vars(`viewOfSpend`),scales = \"free_x\")+\n    scale_y_continuous(labels=seq(1949,2020,5),breaks =seq(1949,2020,5))\n\niraqMissingDataPLOT+\ngeom_hline(yintercept = 1982,color=\"red\")+\ngeom_hline(yintercept = 2003,color=\"red\")+\ngeom_hline(yintercept = 1985,color=\"blue\")+\ngeom_hline(yintercept = 1995,color=\"blue\")+\nannotate(\"text\",x=0,y=1982,label=\"1982\",hjust=-0.1,vjust=-0.1,color=\"red\")+\nannotate(\"text\",x=0,y=2003,label=\"2003\",hjust=-0.1,vjust=1.1,color=\"red\")+\nannotate(\"text\",x=0,y=1985,label=\"Start of Gulf war\",hjust=-0.1,vjust=-0.1,color=\"blue\")+\nannotate(\"text\",x=0,y=1995,label=\"End of Gulf war\",hjust=-0.1,vjust=-0.1,color=\"blue\")\n\n```\n\n### MilitarySpend_ShareofGovSpend\n\n```{r}\nbyRegionStats_GovSpend<-combinedData%>%\n  group_by(Region,viewOfSpend)%>%\n  summarize(mean = mean(Spend, na.rm=TRUE,sigfig=1),\n            std = sd(Spend, na.rm=TRUE),\n            min = min(Spend, na.rm=TRUE),\n            max = max(Spend, na.rm=TRUE))%>%\n  arrange(desc(mean))%>%\n  filter(viewOfSpend==\"MilitarySpend_ShareofGovSpend\")\n\nbyRegionStats_GovSpend\n```\nThe share of Gov spend shows an insanely high max of sub-Saharan African spending as well as the Middle East.The Middle east spending has been explained above however below I will investigate the sub-sahara African spending.\n\n```{r}\nviolin_ShareOfSpend<- na.omit(byRegionStats_GovSpend)%>%\n  ggplot(aes(x=Region,y=Spend))+\n  geom_violin()+\n  theme(axis.text.x=element_text(angle=60,hjust=1))\n\nviolin_gdp\n```\n\n\nZooming into Zimbabwe's Violin plot we can see that they often have an exteremly high military spending when compared to overall spending. As suggested by [5], Zimbabwe's military spending is highly influenced by internal political turbulence more so than economic factors. It should also be mentioned that their military spending is often determined by SIPRI from estimation and not necessarily accurate, for this reason I wont be looking further into the anomaly.\n\n```{r}\ncombinedData%>%\n  filter(viewOfSpend==\"MilitarySpend_ShareofGovSpend\")%>%\n  filter(Region == \"sub-Saharan Africa\")%>%\n  filter(Country==\"Zimbabwe\")%>%\n  ggplot(aes(x=Country,y=Spend))+\n  geom_violin()+\n  theme(axis.text.x=element_text(angle=60,hjust=1))\n\n```\n\nNow that some introductory statistics have been done to explain the data at first glance, we focus in on the heavy hitters in the military spending space and look into how recent global events have affected their spending habits.\n\n\nTop 6 mean spenders\n```{r}\ntop6_mean <- byRegionStats_USD %>%\n  head()%>%\n  pull(Region)\n\ntop6_mean\n```\n\n\n\nThe top 6 spenders stand out not only in their mean spending habits but they continue to spend more and more.\n```{r}\n\nstatsViz2<- byRegionStats_USD%>%\n  mutate(test = fct_reorder(Region,desc(mean)))%>%\n  ggplot(mapping=aes(y = test, x = mean))+  \n  geom_point(aes(color = Region, alpha=0.9, size=max)) +\n  guides(alpha=\"none\",color=\"none\") +\n  labs(title = \"Certain Regions on average spend more than others\" ,caption = \"Data from SPIRI Military Expediture Database\")\n\nstatsViz2\n```\n\n### Top 6 spenders over time\nThis data is scaled for each country on the Y axis so that you can see the shape of the spending compared to global averages. I found the below interesting in that it paints the story of the US setting the pace and overall shape of the graph with East Asia playing a bit of catchup, mostly driven by China.\n\n```{r warning=FALSE}\nbyRegionStats_year_top6<-combinedData%>%\n  group_by(Region,viewOfSpend,Year)%>%\n  summarize(mean = mean(Spend, na.rm=TRUE))%>%\n  filter(viewOfSpend == 'MilitarySpend_currentUSD')%>%\n  filter(Region == top6_mean)%>%\n  arrange(desc(mean))\n\n\n# add global average overlay\nGlobalAverage<-combinedData%>%\n  group_by(viewOfSpend,Year)%>%\n  filter(viewOfSpend==\"MilitarySpend_currentUSD\")%>%\n  summarise(GlobalAverage = mean(Spend),GlobalStandardDev = sd(Spend))\n\nbyRegionplot_top6<- byRegionStats_year_top6%>%\n  ggplot(mapping=aes(x = Year, y = mean))+\n  geom_line(aes(color = Region)) +\n  geom_line(data= GlobalAverage,aes(x=Year,y=GlobalAverage))+\n  facet_wrap(vars(`Region`),scales = \"free_y\") +\n  labs(title = \"Raw Mean Spend in USD for top 6 Spenders with Global Average Overlay\" ,caption = \"Data from SPIRI Military Expediture Database\")\n\n\nbyRegionplot_top6\n\n```\n\n### Top 6 spenders over time with GDP raw value overlay\n\nIn order to show the raw values of military spend and GDP for the top 6 spenders I back calculate the true GDP spend values from the percentage of military spend. This gives an idea of how the relationship of money spent on military causes and domestic production is shaped. We can see that for the most part raw GDP spend increases steadily, while we see more dramatic swings in military spending. An interesting point of note however is the increase in military spending in Eastern Europe and the Middle East associated with a dip in the regions GDP. If I were to continue to expand the report this would be an area of investigation. \n\n```{r warning=FALSE}\nbyRegionStats_year_top6_GDP<-combinedData%>%\n  filter(Region %in% top6_mean)%>%\n  pivot_wider(names_from = viewOfSpend,values_from = Spend)%>%\n  mutate(rawGDP = `MilitarySpend_currentUSD`/`MilitarySpend_ShareofGDP`)%>%\n  group_by(Region,Year)%>%\n  summarize(meanUSD = mean(MilitarySpend_currentUSD, na.rm=TRUE), meanGDP =mean(rawGDP,na.rm=TRUE))\n  \n  \n\nbyRegionplot_top6_GDP<- byRegionStats_year_top6%>%\n  ggplot(mapping=aes(x = Year, y = mean))+\n  geom_line(aes(color = Region)) +\n  geom_line(data= byRegionStats_year_top6_GDP,aes(x=Year,y=meanGDP))+\n  facet_wrap(vars(`Region`),scales = \"free_y\") +\n  labs(title = \"Raw Mean Spend in USD for top 6 Spenders with raw GDP Overlay\" ,caption = \"Data from SPIRI Military Expediture Database\")\n\n\nbyRegionplot_top6_GDP\n\n```\n\n\n### Top and bottom 5 spenders\n\n```{r}\ntopMean<-combinedData%>%\n  group_by(Country,Region,viewOfSpend)%>%\n  summarize(mean = mean(Spend, na.rm=TRUE,sigfig=1),\n            std = sd(Spend, na.rm=TRUE))%>%\n  filter(mean>=1880)%>%\n  arrange(desc(mean))\n\nbotMean<-combinedData%>%\n  group_by(Country,Region,viewOfSpend)%>%\n  summarize(mean = mean(Spend, na.rm=TRUE,sigfig=1),\n            std = sd(Spend, na.rm=TRUE))%>%\n  filter(mean>=1880)%>%\n  arrange(mean)\n\n\n\ncombinedData%>%\n  filter(Country == \"Afghanistan\")%>%\n  na.omit()%>%\n  mean(Spend)\n\n```\n\nTop 5 spenders on average:\n\n```{r echo=FALSE}\nhead(topMean)\n```\n\nBottom 5 spenders on average:\n\n```{r echo=FALSE}\nhead(botMean)\n```\n\n## Top spenders by Country\n\nIn the following analysis I will be looking at significant events which\nimpacted some if not all of the world. For the sake of clarity I will\nonly be focusing on a select group of individual countries which are\nnot directly involved. The top 10 countries which stand out as\nsignificant spenders in the last 10 years will be the ones focused on.\n\n```{r}\n# getting top 10 mean spenders in last 10 years\ntopMeanCountries<-combinedData%>%\n  group_by(Country,viewOfSpend)%>%\n  filter(Year>=2012)%>%\n  filter(viewOfSpend==\"MilitarySpend_currentUSD\")%>%\n  summarize(mean = mean(Spend, na.rm=TRUE,sigfig=1))%>%\n  arrange(desc(mean))%>%\n  head(10)\ntopMeanCountriesVec<-topMeanCountries$Country\ntopMeanCountriesVec\n\n# Raw data for these 10 countries\ntop10SpendCountriesbyYear<-combinedData%>%\n  group_by(Country,viewOfSpend,Year)%>%\n  filter(viewOfSpend==\"MilitarySpend_currentUSD\")%>%\n  filter(Country %in% topMeanCountriesVec)\n\n```\n\n```{r}\ngrouped<-top10SpendCountriesbyYear%>%\n  ungroup()%>%\n  group_by(Country)\n\ntop10CountryTibbles<-grouped%>%\n  group_split(Country)\n\n# Using PURR here! Pretty powerful.\n  # result is list of tibbles which have been processed to contain YoY spend increases\ntop10CountryTibblesYoY<- map(top10CountryTibbles,~ .x %>% mutate(percentChangeYoY = ((Spend - lag(Spend))/Spend)*100))\n\n\n# I then stack these DF on top of eachother to create one single DF to interact with.\ntop10CountryYoY<-bind_rows(top10CountryTibblesYoY)\n         \n```\n\nPlots detailing YoY(Year over Year) spending for each of the top 10 spenders. Green and green line segments indicate that year having an increase or decrease in spending respectively. From this visualization we can see more often than not the spending of most nations is increasing. Germany, France, Japan, and the UK stand out as those who do the most jumping back and forth between spending more or less YoY.\n\n```{r warning=FALSE}\nrect_data <- data.frame(  xmin=c(1990,1990),\n                          xmax=c(2020,2020),\n                          ymin=c(-100,0),\n                          ymax=c(0,20),\n                          col=c(\"green\",\"red\"))\n\nPercentChangeTop10Countries<-top10CountryYoY%>%\n  filter(Year>=1992)%>%\n  mutate(posOrNeg = case_when(\n    percentChangeYoY>0 ~ \"Positive\",\n    percentChangeYoY<0 ~ \"Negative\"\n  ))%>%\n  ggplot()+\n  geom_line(aes(x = Year, y = percentChangeYoY,color = as.factor(posOrNeg)))+\n  facet_wrap(vars(Country),scale=\"free_y\")+\n  theme(axis.text.x=element_text(angle=60,hjust=1))+\n  aes(group=NA)+guides(color = guide_legend(title = \"YoY Positive or negative spend\"))\n  \nPercentChangeTop10Countries\n```\nTo give some perspective on just how much the US and now recently China spends on their military I have left the following vizualization of the top 10 spenders unscaled.\n\n```{r}\ntop10Countries<- top10SpendCountriesbyYear%>%\n  ggplot(mapping=aes(x = Year, y = Spend))+  \n  geom_point(aes(color = Country, alpha=0.9,)) +\n  theme_light() +\n  guides(alpha=\"none\") +\n  labs(title = \"East asia and NA dominate raw spend\" ,caption = \"Data from SPIRI Military Expediture Database\")\n\ntop10Countries+\n  facet_wrap(vars(`Country`))+\n  theme(axis.text.x=element_text(angle=60,hjust=1))\n\n\n\n```\n\n# 9/11 analysis\n\nThe first major global event I want to intentionally focus in on is the September 11th, 2001 attack on the World Trade Center in New York City. This terrorist attack on the United States left the world stunned and had lasting effects on global military spending.\n\n<center>\n\n[![9/11 Memorial Lights](MemorialImage.jpg)](https://www.911memorial.org/visit/memorial/names-911-memorial)\n\n<center>\n\n\n\nTimeline\n1998 - Bill Clinton warned bin laden preparing to hijack US\naircraft\n\n1999 - Germany intercepts intel about plane crash\n\n2001 sept- Attack occurs oct-US attack on Afghanistan starts(end in\n2021)\n\nParties Involved\n  Al-Qaeda \n  - Saudi Arabia \n  - Kuwait\n\n\n\n\nLook at US spending before and after\n```{r}\ntimeLine<-\n  data.frame(\n    xintercept= c(1988,2001),\n    Key_Events = c(\"US warned of possible airplane hijack\",\"2001 attack on United States\"),\n    color = c(\"black\",\"red\"),\n    stringsAsFactors = FALSE\n    )\n\n\nUS911<-combinedData%>%\n  group_by(viewOfSpend,Year)%>%\n  filter(Country == 'United States of America')%>%\n  summarize(mean = mean(Spend, na.rm=TRUE))%>%\n  arrange(desc(mean))\n\n us911Plot<- US911%>%\n  ggplot(mapping=aes(x = Year, y = mean))+\n  geom_line() +\n  geom_vline(data= timeLine,aes(xintercept=xintercept,color=Key_Events))+\n  labs(fill = \"Key Events\")+\n  scale_colour_manual(values = timeLine$color)+\n  facet_wrap(vars(`viewOfSpend`),scales = \"free_y\") +\n  labs(title = \"United States Military response to 9/11\" ,caption = \"Data from SPIRI Military Expediture Database\")+\n  theme(legend.position = \"bottom\")\n \nus911Plot\n\n\n\n```\n\nIt looks like the event of 9/11 had a pretty significant impact on US\nspending. While initially it looks like spending just continues to rise\nwhen looking at the raw USD spending, it is refreshing to see the share\nof Gov spend has trended down in recent years as money is being spent\nelsewhere. Another interesting observation is that there was a slight\nupward trend in spending prior to the attack in 2001 however the\nspending increase was mostly reactionary.\n\n```{r}\nus911Plot+\n  coord_cartesian((xlim=c(1990,2010)))\n\n```\nIf we look at Spending for the other top 10 Spending countries we see that their spending increased along with the United States.\n```{r}\ntop10Countries<- top10SpendCountriesbyYear%>%\n  ggplot(mapping=aes(x = Year, y = Spend))+  \n  geom_point(aes(color = Country, alpha=0.9)) +\n  theme_light() +\n  guides(alpha=\"none\") +\n  labs(title = \"How Top 10 spending Nations reacted to 2001 attack on the World Trade Center\" ,caption = \"Data from SPIRI Military Expediture Database\")\n\ntop10Countries+\n  geom_vline(xintercept = 2001,color=\"black\")+\n  facet_wrap(vars(`Country`),scales = \"free_y\")+\n  theme(axis.text.x=element_text(angle=60,hjust=1),legend.position = \"None\")+\n  coord_cartesian((xlim=c(1990,2010)))\n\n```\n\n\n# Ukraine war analysis\nDue to the recency of the Russo-Ukrainian War I will only be able to provide an analysis of the time period building up to the invasion of Ukraine. In order to get an idea of if and how different regions, and their respective countries, prepared for the invasion I overlay the top 10 spenders with key dates.\n\n```{r}\ntop10CountriesUkraineWar<- top10SpendCountriesbyYear%>%\n  ggplot(mapping=aes(x = Year, y = Spend))+  \n  geom_point(aes(color = Country, alpha=0.9)) +\n  theme_light() +\n  guides(alpha=\"none\")+\n  labs(title = \"How Top 10 spending Nations prepared for 2022 invasion of Ukraine\" ,caption = \"Data from SPIRI Military Expediture Database\")\n\ntop10CountriesUkraineWar+\n  geom_vline(xintercept = 2020,color='black')+\n  geom_vline(xintercept = 2015,color='black')+# war in the donbas\n  facet_wrap(vars(`Country`),scales = \"free_y\")+\n  theme(axis.text.x=element_text(angle=60,hjust=1),legend.position = \"None\")+\n  coord_cartesian((xlim=c(2010,2020)))\n\n\n\n```\n\nFrom the above we can somewhat see a trend in increased spending from the top 10 spenders. Next we investigate the Nations geographically surrounding Russia. Upon Putin's first election, spending grew and then come his re-election spending increased at an expedited rate in Central and Eastern Europe.\n\n```{r}\nukrainePlot<- combinedData%>%\n  filter(viewOfSpend==\"MilitarySpend_currentUSD\")%>%\n  filter(Region %in% c(\"Eastern Europe\",\"Central Europe\"))%>%\n  filter(Country!=\"Russia\")%>%\n  filter(Year>=1995)%>%\n  group_by(Region,Year)%>%\n  summarise(Spend=mean(Spend))%>%\n    ggplot(mapping=aes(x = Year, y = Spend))+  \n      geom_line(aes(color = Region, alpha=0.9)) +\n      theme_light() +\n      guides(alpha=\"none\")+\n      labs(title = \"How Russian Bordering Nations responded to Putin election and invasion\" ,caption = \"Data from SPIRI Military Expediture Database\")\n\n\nUkrainePlot+\n      geom_vline(xintercept = 2020,color='red',linetype=\"solid\")+# official invasion\n        annotate(\"text\",x=2020,y=500,label=\"Invasion of Ukraine\",hjust=0.5,vjust=-0.1,color=\"black\",angle='90',size=3)+\n      geom_vline(xintercept = 2015,color='red',linetype=\"dashed\")+# war in the donbas\n        annotate(\"text\",x=2015,y=500,label=\"War in the Donbas\",hjust=0.5,vjust=-0.1,color=\"black\",angle='90',size=3)+\n      geom_vline(xintercept = 2004,color='black',linetype=\"solid\")+ # putin first election\n        annotate(\"text\",x=2004,y=1500,label=\"Putin re-elected\",hjust=0.7,vjust=-0.1,color=\"black\",angle='90',size=3)+\n      geom_vline(xintercept = 2000,color='black',linetype=\"dashed\")+ # putin Wins presidential election securing second term\n        annotate(\"text\",x=2000,y=1500,label=\"Putin wins first election\",hjust=0.7,vjust=-0.1,color=\"black\",angle='90',size=3)+\n      facet_wrap(vars(`Region`))+\n      theme(axis.text.x=element_text(angle=60,hjust=1),legend.position = \"None\")\n```\n\nNations surrounding Ukraine and Russia had some of the most defined reactions to Putins re-election and the war in the Donbas. Vertical lines represetnt the same events as in the last vizualization.\n```{r}\ncombinedData%>%\n  filter(viewOfSpend==\"MilitarySpend_currentUSD\")%>%\n  filter(Country %in% c(\"Russia\",\"Ukraine\",\"Poland\",\"Belarus\",\"Moldova\",\"Kazakhstan\",\"Romania\",\"Slovakia\"))%>%\n    ggplot(mapping=aes(x = Year, y = Spend))+  \n    geom_point(aes(color = Country, alpha=0.9)) +\n    theme_light() +\n    guides(alpha=\"none\")+\n    labs(title = \"How Top 10 spending Nations prepared for 2022 invasion of Ukraine\" ,caption = \"Data from SPIRI Military Expediture Database\")+\n    geom_vline(xintercept = 2020,color='red',linetype=\"solid\")+# official invasion\n    geom_vline(xintercept = 2015,color='red',linetype=\"dashed\")+# war in the donbas\n    geom_vline(xintercept = 2004,color='black',linetype=\"solid\")+ # putin first election\n    geom_vline(xintercept = 2000,color='black',linetype=\"dashed\")+ # putin Wins presidential election securing second term\n    facet_wrap(vars(`Country`),scales = \"free_y\")+\n    theme(axis.text.x=element_text(angle=60,hjust=1),legend.position = \"None\")+\n    coord_cartesian((xlim=c(1990,2020)))\n\n\n```\n\n\n# Global USD Military spending through all available years\n\n```{r}\n\n# might facet this out for all the tabs??\n\nGlobalReviewPlot<- GlobalAverage%>%\n  ggplot()+\n  geom_line(data= GlobalAverage,aes(x=Year,y=GlobalAverage),size=1.5)\n\n\n# annotations\n\nGlobalReviewPlot\n\n# +\n#   geom_vline(xintercept = 2001,color=\"red\")+#9/11\n#   geom_vline(xintercept = 2020,color=\"red\")+#covid declared a pandemic march 11 2020\n#   geom_vline(xintercept = 2021,color=\"red\")\n#   labs(title=\"Average Global spending in USD\")\n\n```\n\n\n```{r}\nGlobalReviewPlot+\n  geom_ribbon(data=GlobalAverage,aes(y=GlobalAverage,ymin=GlobalAverage-GlobalStandardDev,ymax=GlobalAverage+GlobalStandardDev,x=Year),alpha=0.2)\n```\n\n## Conclusion\n\n> \"Every gun that is made, every warship launched, every rocket fired\n> signifies in the final sense, a theft from those who hunger and are\n> not fed, those who are cold and are not clothed. \\> \\> This world in\n> arms is not spending money alone. It is spending the sweat of its\n> laborers, the genius of its scientists, the hopes of its children.\n> This is not a way of life at all in any \\> true sense. Under the\n> clouds of war, it is humanity hanging on a cross of iron.\"\n\nDwight D. Eisenhower\n\nAfter reviewing the data at a high level and diving deeper into spending surrounding 9/11 and the Russo-Ukraine war I have found a few facts have held true through the years. Powerful country Military spending rises like ships in high tide, when one goes up, they all do. In the years leading up to an altercation the nations involved often increased spending both in raw USD as well as percentage of their government spend and GDP. In the future I would like to spend some more time analyzing the tabs other than USD spend and look a little bit more at the times of peace and how countries would prioritize spending that time period. I had a lot of fun with this project and can say now that I am competent with R even when starting with zero experience beforehand. \n\n\n# Citations\n[1]\nhttps://www.goodreads.com/quotes/tag/military-budget#:\\~:text=%E2%80%9CEvery%20gun%20that%20is%20made,is%20not%20spending%20money%20alone.\n\n[2]\nhttps://www.sipri.org/about\n\n[3]\nR Core Team (2017). R: A language and environment for statistical\ncomputing. R Foundation for Statistical Computing, Vienna, Austria. URL\nhttps://www.R-project.org/.\n\n[4]\nWickham, H., & Grolemund, G. (2016). R for data science: Visualize,\nmodel, transform, tidy, and import data. OReilly Media.\n\n[5]\nTambudzai, Z. (2011). Determinants of military expenditure in Zimbabwe. The Economics of Peace and Security Journal, 6(2). doi:http://dx.doi.org/10.15355/epsj.6.2.41\n\n[6]\nhttps://www.investopedia.com/terms/g/gdp.asp\n\n[7]\nCenters for Disease Control and Prevention. (2022, August 16). CDC Museum Covid-19 Timeline. Centers for Disease Control and Prevention. Retrieved December 7, 2022, from https://www.cdc.gov/museum/timeline/covid19.html \n\n[8] https://www.istockphoto.com/photo/9-11-memorial-beams-with-statue-of-liberty-and-lower-manhattan-gm1271263089-373908152\n\n# Appendix\n\nFull descriptions of source sheet tabs as provided by SIPRI:\n1.  Introduction\n2.  Estimates of world, regional and sub-regional totals in\n    constant (2019) US\\$ (billions).\n3.  Data for military expenditure by country in current price local\n    currency, presented according to each country's financial year.\n4.  Data for military expenditure by country in current price local\n    currency, presented according to calendar year.\n5.  Data for military expenditure by country in constant price (2019)\n    US\\$ (millions), presented according to calendar year, and in\n    current US\\$m. for 2020.\n6.  Data for military expenditure by country in current US\\$ (millions),\n    presented according to calendar year.\n7.  Data for military expenditure by country as a share of GDP,\n    presented according to calendar year.\n8.  Data for military expenditure per capita, in current US\\$, presented\n    according to calender year. (1988-2020 only)\n9.  Data for military expenditure as a percentage of general government\n    expenditure. (1988-2020 only)\n\n\nAdditional Country info:\n\n```{r echo=FALSE}\ntotNumCountries\n```\nList of Countries:\n```{r echo=FALSE}\nListOfCountries\n```\n\n\nNumber of countries by region:\n```{r echo=FALSE}\nNumCountriesByRegion\n```\n\n## Cleaning with intermitant steps\n# Input and Cleaning\n\n## Reading in raw information\n\nThe data provided by the Stockholm International Peace Research\nInstitute(SIPRI) was separated into multiple tabs in one excel .xlsx\nfile.\n\nIn order to begin working I imported the tabs I planned to utilize,\nskipping over some of the notes and title rows at the start of each tab.\n\n```{r}\nrawData_CurrentUSD <- read_excel(\"_data/SIPRI-Milex-data-1949-2021.xlsx\",sheet=sheets[6],skip=5)\nrawData_ShareOfGDP <- read_excel(\"_data/SIPRI-Milex-data-1949-2021.xlsx\",sheet=sheets[7],skip=5)\nrawData_ShareOfGovSpend <- read_excel(\"_data/SIPRI-Milex-data-1949-2021.xlsx\",sheet=sheets[9],skip=7)\n```\n\n```{r echo=FALSE}\n# output\nhead(rawData_CurrentUSD)\n#head(rawData_ShareOfGDP)\n#head(rawData_ShareOfGovSpend)\n```\n\nNext I delete the first row of NA as well as the Notes column for each\ntibble.\n\n```{r}\nrawData_CurrentUSD <- rawData_CurrentUSD[-1,]  %>%\n  select(-Notes)\nrawData_ShareOfGDP <- rawData_ShareOfGDP[-1,] %>%\n  select(-Notes)\nrawData_ShareOfGovSpend <- rawData_ShareOfGovSpend[-1,] %>%\n  select(-2:-3)\n```\n\n```{r echo=FALSE}\nhead(rawData_CurrentUSD)\n#head(rawData_ShareOfGDP)\n#head(rawData_ShareOfGovSpend)  \n```\n\n## Tidying Data\n\nBefore pivoting my data I wanted to add a column for region. I chose to\ndo this with an algorithm as an exercise in iteration however it would\nhave been more practical to just hard code this column.\n\nThe list of countries where there are NA's for every year:\n\n```{r}\nRegions <- rawData_CurrentUSD %>%\n  filter(is.na(`1949`))%>%\n  select(Country)\n\nRegions\n```\n\nYou will notice that some of these are continents and sub-continents, I\nwanted to break these into a `Region` field. The pattern I saw and chose\nto exploit was the fact that the overarching category would always be\nfollowed with a more specific category such as the **Africa** followed\nby **North Africa** values (see earlier print outs to see raw\ninformation).\n\nI then added an empty vector into the tibble and populated it according\nto the Country column using the pattern described above.\n\nOnce I had left flags in the region column dictating where each region\nwas starting I could use `fill(Region)` in order to populate the rest of\nthe column.\n\n```{r}\nemptyRegionCol <- as.numeric(vector(mode = \"character\",length = length(rawData_CurrentUSD$`1949`)))## doing as numeric here as a hacky way to fill this with NA's, any better way?\n\n#adding col to tibble to be populated later\nmutated_CurrentUSD <- rawData_CurrentUSD %>%\n  mutate(Region =emptyRegionCol,.before=2)\n\n# replacing the empty char in region with actual region if 2 NAs appear in a row\n  #iterates along the indices of the Country vector\nfor(i in seq_along(mutated_CurrentUSD$Country) ){\n   #if 2 nas in a row then do something\n  if(is.na(mutated_CurrentUSD$`1949`[i]) && is.na(mutated_CurrentUSD$`1949`[i+1]) ){\n    mutated_CurrentUSD$Region[i+1] <- mutated_CurrentUSD$Country[i+1] #this works because when referencing an index outside of the vector R will return NA - Great to know.\n  }\n  #if the row is a region\n  if(is.na(mutated_CurrentUSD$`1949`[i]) ){\n     mutated_CurrentUSD$Region[i+1] <- mutated_CurrentUSD$Country[i]\n  }\n}\n\nmutated_CurrentUSD <- mutated_CurrentUSD %>%\n  fill(Region)\n\nhead(mutated_CurrentUSD)\n```\n\nNow that I had my proof of concept for cleaning one of the sheets, in a\nformat I wanted, it was time to clean the other sheets as well. I could\nhave taken the above code and modified it to work for each of the\nother tabs individually however I took the opportunity to practice with\nfunctions and created the below function to clean any of the tabs once\nthey were loaded in and lightly pre-processed.\n\n## Clean and format function\n\n```{r}\n## creating a function to clean the other sheets\n##Input: a partially cleaned tibble, must have been read in and had excess rows trimmed\n##output: tibble with regions correctly labeled and umbrella region categories i.e Africa above south Africa removed\n##Note: All sub categories contained the main category name in them, will use regex to create groupings in the future.\nCleanData <- function(inSheet){\n  emptyRegionCol <- as.numeric(vector(mode = \"character\",length = nrow(select(inSheet,2))))\n\n  #adding col to tibble to be populated later\n  output <- inSheet %>%\n    mutate(Region = emptyRegionCol,.before=2)\n\n\n  # replacing the empty char in region with actual region if 2 NAs appear in a row\n    #iterates along the indices of the Country vector\n  for(i in seq_along(output$Country)){\n  \n    if(is.na(output[[i,3]]) && is.na(output[[(i+1),3]]))\n      output$Region[i+1] <- output$Country[i+1]\n    \n    if(is.na(output[[i,3]]))\n       output$Region[i+1] <- output$Country[i]\n  }\n  \n  output <- output %>%\n    fill(Region)\n  \n  \n  # removing header rows\n  output <- output %>%\n    filter(!is.na(output[[3]]))\n}\n\n```\n\nBelow I call the function on each of the tibbles loaded in earlier. For\nthe sake of space I will only show one tab being cleaned.\n\nBefore:\n\n```{r echo=FALSE}\n#head(rawData_CurrentUSD)\n#head(rawData_ShareOfGDP)\nhead(rawData_ShareOfGovSpend)\n```\n\n```{r}\nCleaned_currentUSD <- CleanData(rawData_CurrentUSD)\nCleaned_ShareOfGovSpend <- CleanData(rawData_ShareOfGovSpend)\nCleaned_ShareOfGDP <- CleanData(rawData_ShareOfGDP)\n```\n\nAfter:\n```{r echo=FALSE}\n#head(Cleaned_currentUSD)\n#head(Cleaned_ShareOfGovSpend)\nhead(Cleaned_ShareOfGDP)\n\n```\n\n## Pivoting and Restructuring\n\n### Pivot and Notation Changes\n\nNext I pivot the years, it should be noted that both the pivoting and\nConverting of notation could be handled by the clean function above, i\nkept the steps separate so that I could show the progression of the\ndataframe.\n\nI must also handle the xxx and ... notations. From the information page\nof my data set I can see that the notation is described as follows:\n\n| Raw Notation | Meaning                                                                                 |\n|------------------------------------|------------------------------------|\n| ...          | Data unavailable                                                                        |\n| xxx          | Country did not exist or was not independent during all or part of the year in question |\n\nFor now I think I will just keep both as NA but will save this form of\nthe information for future use.\n\nAfter pivot and notation changes:\n\n```{r}\nCleaned_currentUSD <- Cleaned_currentUSD %>%\n  pivot_longer(cols=3:ncol(Cleaned_currentUSD),names_to = \"Year\",values_drop_na = FALSE)%>%\n    na_if(\"...\") %>%\n      na_if(\"xxx\")\n  \nCleaned_ShareOfGovSpend <- Cleaned_ShareOfGovSpend %>%\n  pivot_longer(cols=3:ncol(Cleaned_ShareOfGovSpend),names_to = \"Year\",values_drop_na = FALSE)%>%\n    na_if(\"...\") %>%\n      na_if(\"xxx\")\n\nCleaned_ShareOfGDP <- Cleaned_ShareOfGDP %>%\n  pivot_longer(cols=3:ncol(Cleaned_ShareOfGDP),names_to = \"Year\",values_drop_na = FALSE)%>%\n    na_if(\"...\") %>%\n      na_if(\"xxx\")\n\n\ndf1<-head(Cleaned_currentUSD)\ndf2<-head(Cleaned_ShareOfGovSpend)\ndf3<-head(Cleaned_ShareOfGDP)\n\n\n#df1\n#df2\n# share of GDP\ndf3\n\n\n```\n\n### Converting Column Types\n\nFinally I will convert the column types to their correct representation.\n\nBefore:\n\n```{r echo=FALSE}\n#head(Cleaned_currentUSD)\n#head(Cleaned_ShareOfGovSpend)\nhead(Cleaned_ShareOfGDP)\n\n```\n\n```{r}\n#Year to Number\nCleaned_currentUSD$Year<-as.integer(Cleaned_currentUSD$Year)\nCleaned_ShareOfGovSpend$Year<-as.integer(Cleaned_ShareOfGovSpend$Year)\nCleaned_ShareOfGDP$Year<-as.integer(Cleaned_ShareOfGDP$Year)\n\n# value to double\nCleaned_currentUSD$value <- as.numeric(Cleaned_currentUSD$value)\nCleaned_ShareOfGovSpend$value<- as.numeric(Cleaned_ShareOfGovSpend$value)\nCleaned_ShareOfGDP$value<- as.numeric(Cleaned_ShareOfGDP$value)\n```\n\nAfter:\n\n```{r echo=FALSE}\n#head(Cleaned_currentUSD)\n#head(Cleaned_ShareOfGovSpend)\nhead(Cleaned_ShareOfGDP)\n```\n\n\n\n\n\n\n```{r echo=FALSE}\nCleaned_currentUSD <- Cleaned_currentUSD %>%\n  rename(MilitarySpend_currentUSD=value)\n\nCleaned_ShareOfGovSpend <- Cleaned_ShareOfGovSpend%>%\n  rename(MilitarySpend_ShareofGovSpend=value)\n\nCleaned_ShareOfGDP <- Cleaned_ShareOfGDP%>%\n  rename(MilitarySpend_ShareofGDP=value)\n\n```\n\n### Joining of the Different Tabs\n\nHere we do a full join to maintain data from all the different tabs. The years when share of Gov spend are unavaiable will then show NA as intended.\n\n```{r}\n#nrow(Cleaned_currentUSD)\n#nrow(Cleaned_ShareOfGovSpend)\n#nrow(Cleaned_ShareOfGDP)\n\nMilitarySpend<- full_join(Cleaned_currentUSD,Cleaned_ShareOfGovSpend,by=c(\"Country\",\"Year\",\"Region\"))\n\nMilitarySpend <- full_join(MilitarySpend,Cleaned_ShareOfGDP,by=c(\"Country\",\"Year\",\"Region\"))\n\n\n\nhead(MilitarySpend)\n#nrow(MilitarySpend)\n```\n\n\n## extra Vizualizations\n\n```{r warning=FALSE}\nbyRegionStats_year_top6<-combinedData%>%\n  group_by(Region,viewOfSpend,Year)%>%\n  summarize(mean = mean(Spend, na.rm=TRUE))%>%\n  filter(viewOfSpend == 'MilitarySpend_currentUSD')%>%\n  filter(Region == top6_mean)%>%\n  arrange(desc(mean))\n\n\n# add global average overlay\nGlobalAverage<-combinedData%>%\n  group_by(viewOfSpend,Year)%>%\n  filter(viewOfSpend==\"MilitarySpend_currentUSD\")%>%\n  summarise(GlobalAverage = mean(Spend),GlobalStandardDev = sd(Spend))\n\nbyRegionplot_top6<- byRegionStats_year_top6%>%\n  ggplot(mapping=aes(x = Year, y = mean))+\n  geom_point(aes(color = Region, alpha=0.9,)) +\n  geom_line(data= GlobalAverage,aes(x=Year,y=GlobalAverage))+\n  facet_wrap(vars(`Region`)) +\n  labs(title = \"Raw Mean Spend in USD for top 6 Spenders with Global Average Overlay\" ,caption = \"Data from SPIRI Military Expediture Database\")\n\n\n\n\nbyRegionplot_top6\n\n```\n\n## Animations\n```{r}\n# animationWIP<-combinedData%>%\n#   group_by(Country,viewOfSpend,Year)%>%\n#   pivot_wider(names_from = viewOfSpend,values_from = Spend)\n# \n# \n# ggplot(animationWIP, aes(x=`Year`,y=`MilitarySpend_currentUSD`, color = Country,size= MilitarySpend_ShareofGDP))+\n#   geom_point(alpha = 0.6,)+\n#   scale_radius(limits = c(0, NA), range = c(2, 12)) +\n#   facet_wrap(vars(Region),scales = \"free_y\")+\n#   labs(title = 'Year: {frame_time}', x = 'Share of Gov Spend', y= 'raw USD')+\n#   theme(legend.position = \"none\")\n# \n# myAnimation<- ggplot(animationWIP, aes(x=`Year`,y=`MilitarySpend_currentUSD`, color = Country,size= MilitarySpend_ShareofGDP))+\n#   geom_point(alpha = 0.6,)+\n#   scale_radius(limits = c(0, NA), range = c(2, 12)) +\n#   facet_wrap(vars(Region),scales = \"free_y\")+\n#   labs(title = 'Year: {frame_time}', x = 'Year', y= 'raw USD')+\n#   theme(legend.position = \"none\")+\n#   transition_time(`Year`)+\n#   ease_aes('linear')\n# \n# animate(myAnimation,duration = 15,fps = 20,width=600,height = 600, renderer = gifski_renderer())\n# anim_save(\"GovSpend_VS_RawUSD.gif\")\n\n\n```\n\n\n```{r}\n# world_map<-map_data(\"world\")%>%\n#   filter(! long>180)\n#   \n# gsub(\"USA\",\"United states of America\",world_map)\n# \n# view(world_map)\n# \n# dataForMap<- combinedData %>%\n#   filter(viewOfSpend == \"MilitarySpend_currentUSD\")%>%\n#   rename(region=Country)\n# view(dataForMap)\n# \n# worldMapCountries<-world_map%>%\n#   distinct(region)\n# \n# mapAnimationData<-left_join(world_map,dataForMap)%>%\n#   filter(viewOfSpend==\"MilitarySpend_currentUSD\")\n# \n# \n# test<-mapAnimationData%>%\n#   group_by(long,lat,region)%>%\n#   summarize(mean = mean(Spend, na.rm=TRUE))\n# \n# \n# test%>%\n#   ggplot(aes(fill=mean, map_id=region))+\n#   geom_map(map=world_map)\n# \n# \n# test %>% \n#   ggplot(aes(map_id = region,fill=mean)) +\n#   geom_map(map = world_map) +\n#   expand_limits(x = world_map$long, y = world_map$lat)\n\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"paged","error":true,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":true,"code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":true,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"output-file":"Final Project _ JulianCastoro.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.0.37","execution":{"freeze":"auto"},"smooth-scroll":true,"page-layout":"full","mainfont":"Open Sans","linkcolor":"#881c1c","theme":{"light":["flatly","../styles.scss"],"dark":["darkly","../styles.scss"]},"comments":{"giscus":{"repo":"DACSS/601_Fall_2022","category":"Announcements"}},"toc-location":"right","search":true,"title":"Global Military Spending - An Analysis","description":"WIP Final Project","author":"Julian Castoro","date":"`r Sys.Date()`","editor":{"markdown":{"wrap":72}},"tags":["Julian Castoro","Final Project"],"code-copy":true},"extensions":{"book":{"multiFile":true}}}}}